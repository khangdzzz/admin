<template>
  <div class="create-new-vehicle-type-form">
    <a-card :bordered="false">
      <h3 class="create-new-vehicle-type-form__title">Edit Vehicle type</h3>
      <a-form
        :model="dynamicValidateForm"
        name="basic"
        autocomplete="off"
        @finish="handleFinish">
        <CustomForm
          :formData="dynamicValidateForm.formData"
          @change="handleOnChange"
          @onBlur="handleOnBlur"
          @onFocus="handleOnFocus">
        </CustomForm>
        <div class="create-new-vehicle-type-form__action">
          <a-button
            class="create-new-vehicle-type-form__action--cancel"
            :disabled="isLoading"
            @click="redirectToVehicleType">
            {{ $t("btn_cancel") }}
          </a-button>
          <a-button
            type="primary"
            class="create-new-vehicle-type-form__action--save"
            html-type="save"
            :disabled="!isValidated"
            :loading="isLoading">
            {{ $t("btn_save") }}
          </a-button>
        </div>
      </a-form>
    </a-card>
  </div>
</template>

<script setup lang="ts">
//#===🍆===🍆===🍆===🍆===🍆===🍆===🍆===🍆===🍆===🍆===🍆===🍆import
import CustomForm from "../../base/components/CustomForm.vue";
import { inject, onMounted, reactive, ref } from "vue";
import { routeNames } from "@/routes/route-names";
import { router } from "@/routes";
import { i18n } from "@/i18n";
import { service } from "@/services";
import { commonStore } from "@/stores";
import { useRoute } from "vue-router";
import { MessengerType } from "@/modules/base/models/messenger-type.enum";
import { VehicleTypeModel } from "../models";

//#endregion===🍆===🍆===🍆===🍆===🍆===🍆===🍆===🍆===🍆===🍆===🍆===🍆

//#===👜===👜===👜===👜===👜===👜===👜===👜===👜===👜===👜===👜Props
//#endregion===👜===👜===👜===👜===👜===👜===👜===👜===👜===👜===👜===👜Props

//#===🍎===🍎===🍎===🍎===🍎===🍎===🍎===🍎===🍎===🍎===🍎===🍎Variables
const isValidated = ref<boolean>(false);
const isLoading = ref<boolean>(false);
const route = useRoute();
const userStore = commonStore();
const vehicleTypeId = ref<string | string[]>("");
const vehicleTypeDetail = ref<VehicleTypeModel>();
const messenger: (
  title: string,
  message: string,
  type: MessengerType,
  callback: (() => void) | undefined
  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
) => void = inject("messenger")!;
// eslint-disable-next-line @typescript-eslint/no-explicit-any
const dynamicValidateForm = reactive<{ formData: any[] }>({
  formData: [
    {
      inputType: "AInput",
      value: "",
      placeHolder: "Name",
      label: "Name",
      name: "name",
      disabled: isLoading,
      required: true,
      key: 1,
      isFocus: false,
      rules: [
        {
          required: true,
          message: i18n.global.t("please_enter_input", {
            fieldName: i18n.global.t("vehicle_type")
          })
        },
        {
          max: 50,
          message: i18n.global.t("max_length_input", { maxLength: 50 })
        }
      ]
    }
  ]
});
const handleOnChange = (value: string, index: number): void => {
  isValidated.value = dynamicValidateForm.formData[index].value.length > 0;
};
const handleOnBlur = (
  value: number | boolean | Event,
  index: string | number | Event
): void => {
  index = Number(index);
  dynamicValidateForm.formData[index].isFocus = false;
};
const handleOnFocus = (index: number | boolean | Event): void => {
  index = Number(index);
  dynamicValidateForm.formData[index].isFocus = true;
};
const redirectToVehicleType = (): void => {
  router.push({ name: routeNames.vehicleType });
};
const getVehicleTypeDetail = async () => {
  const response = await service.vehicleType.getVehicleTypeById(
    vehicleTypeId.value
  );
  if (response) {
    vehicleTypeDetail.value = response;
  }
};
const handleFinish = async (): Promise<void> => {
  isLoading.value = true;
  const ternantId = userStore.user?.tenantId;
  const name = dynamicValidateForm.formData[0].value;
  const response = await service.vehicleType.editVehicleTypeById(
    vehicleTypeId.value,
    ternantId,
    name
  );
  if (response) {
    messenger(
      "edit_vehicle_type_successfully",
      "",
      MessengerType.Success,
      () => {
        redirectToVehicleType();
      }
    );
  } else {
    messenger(
      "edit_failed",
      "Please try again later",
      MessengerType.Error,
      () => {
        redirectToVehicleType();
      }
    );
  }
  isLoading.value = false;
};
//#endregion===🍎===🍎===🍎===🍎===🍎===🍎===🍎===🍎===🍎===🍎===🍎===🍎

//#===🦌===🦌===🦌===🦌===🦌===🦌===🦌===🦌===🦌===🦌===🦌===🦌Hooks
onMounted(() => {
  vehicleTypeId.value = route.params?.id;
});
//#endregion===🦌===🦌===🦌===🦌===🦌===🦌===🦌===🦌===🦌===🦌===🦌===🦌

//#===🌊===🌊===🌊===🌊===🌊===🌊===🌊===🌊===🌊===🌊===🌊===🌊Methods
//#endregion===🌊===🌊===🌊===🌊===🌊===🌊===🌊===🌊===🌊===🌊===🌊===🌊

//#===🍏===🍏===🍏===🍏===🍏===🍏===🍏===🍏===🍏===🍏===🍏===🍏Computed
//#endregion===🍏===🍏===🍏===🍏===🍏===🍏===🍏===🍏===🍏===🍏===🍏===🍏

//#===🐍===🐍===🐍===🐍===🐍===🐍===🐍===🐍===🐍===🐍===🐍===🐍Emits
//#endregion===🐍===🐍===🐍===🐍===🐍===🐍===🐍===🐍===🐍===🐍===🐍===🐍

//===👀===👀===👀===👀===👀===👀===👀===👀===👀===👀===👀===👀Watchers
//#endregion===👀===👀===👀===👀===👀===👀===👀===👀===👀===👀===👀===👀
</script>

<style lang="scss" scoped>
.create-new-vehicle-type-form {
  font-family: "Roboto" !important;
  font-style: normal;
  width: 660px;
  height: auto;
  margin: auto;
  background-color: $neutral-0;
  position: relative;
  top: 50%;
  transform: translateY(-50%);
  border-radius: 20px;
  padding: 6px 0;

  &__title {
    font-size: 22px;
    font-weight: 600;
    line-height: 18px;
    text-align: center;
    margin-bottom: 30px;
  }

  &__action {
    display: flex;
    flex-direction: row;
    text-align: center;
    font-weight: 600;
    font-size: 18px;
    line-height: 100%;
    justify-content: center;
    margin-top: 6px;

    &--cancel,
    &--save {
      width: 175px !important;
      height: 48px !important;
      height: 18px;
      font-family: "Roboto";
      font-style: normal;
      font-weight: 600;
      font-size: 18px;
      line-height: 100%;
      padding: 15px;
    }

    &--cancel {
      color: $primary-400;
      border-color: $primary-400;
      margin-right: 20px;
    }
  }
}

.create-new-vehicle-type-form__action--save.active {
  background: $primary;
  color: $neutral-0;
}
</style>
